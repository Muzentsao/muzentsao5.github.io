<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>æ­£é¤é¤ç›’å ±åƒ¹å–®ï¼ˆäº’å‹•ç‰ˆï½œå±¤ç´šä¸‹æ‹‰ + Excel åŒ¯å‡ºï¼‰</title>
<link rel="preconnect" href="https://cdnjs.cloudflare.com"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
:root { 
  --primary: #FF8C42; /* ä¸»è‰²ï¼šæ¸©æš–æ©™ï¼ˆé€‚é…é¤é¥®ï¼‰ */
  --primary-light: #FFF0E6; /* ä¸»è‰²æµ…ç‰ˆï¼ˆèƒŒæ™¯ç”¨ï¼‰ */
  --secondary: #4CAF50; /* è¾…åŠ©è‰²ï¼šæ¸…æ–°ç»¿ï¼ˆé‡‘é¢/ç¡®è®¤ç”¨ï¼‰ */
  --tertiary: #E3F2FD; /* è¾…åŠ©è‰²ï¼šæµ…è“ï¼ˆè¡¨å•ç„¦ç‚¹ç”¨ï¼‰ */
  --ink: #2D3748; /* æ­£æ–‡è‰²ï¼šæ·±ç°ï¼ˆæ›´æ˜“è¯»ï¼‰ */
  --muted: #718096; /* è¾…åŠ©æ–‡å­—ï¼šä¸­ç° */
  --light-gray: #F7FAFC; /* èƒŒæ™¯è‰²ï¼šææµ…ç° */
  --line: #E2E8F0; /* è¾¹æ¡†è‰²ï¼šæµ…ç° */
  --danger: #E53E3E; /* å±é™©è‰²ï¼šçº¢è‰²ï¼ˆåˆ é™¤ç”¨ï¼‰ */
  --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
  --shadow: 0 4px 12px rgba(0,0,0,0.08);
  --radius: 16px; /* ç»Ÿä¸€åœ†è§’ï¼ˆæ›´ç°ä»£ï¼‰ */
  --radius-sm: 12px; /* å°å…ƒç´ åœ†è§’ */
  --transition: all 0.2s ease; /* ç»Ÿä¸€è¿‡æ¸¡åŠ¨ç”» */
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body { 
  font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", "Segoe UI", Roboto, Arial, "PingFang TC", "Microsoft JhengHei", sans-serif; 
  background: var(--light-gray); 
  color: var(--ink);
  line-height: 1.5;
}

.container { 
  max-width: 1200px; 
  margin: 32px auto; 
  background: #fff; 
  border-radius: var(--radius); 
  box-shadow: var(--shadow); 
  overflow: hidden; 
  border: 1px solid var(--line);
}  

header { 
  padding: 24px 32px; 
  border-bottom: 1px solid var(--line); 
  display: flex; 
  gap: 24px; 
  align-items: center; 
  justify-content: space-between; 
  flex-wrap: wrap; 
  background-color: var(--primary-light);
}

h1 { 
  font-size: 24px; 
  color: var(--primary); 
  font-weight: 700;
}

.muted { 
  color: var(--muted); 
  font-size: 14px; 
  margin-top: 4px;
}

/* æŒ‰é’®æ ·å¼ä¼˜åŒ– */
.toolbar button, #btn-add { 
  padding: 12px 20px; 
  border: none; 
  border-radius: var(--radius-sm); 
  background: var(--primary); 
  color: #fff; 
  cursor: pointer; 
  font-weight: 600;
  transition: var(--transition);
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.toolbar button::before { content: "ğŸ“¥"; }
#btn-add::before { content: "â•"; }

.toolbar button:hover, #btn-add:hover { 
  background: #E07B39; /* ä¸»è‰²åŠ æ·± */
  transform: translateY(-2px);
  box-shadow: var(--shadow-sm);
}

.toolbar button:active, #btn-add:active { transform: translateY(0); }

main { padding: 28px 32px; }

/* è¡¨å•åŒºå—æ ·å¼ */
.block { 
  border: 1px solid var(--line); 
  border-radius: var(--radius); 
  padding: 20px; 
  background-color: #fff;
  box-shadow: var(--shadow-sm);
  margin-bottom: 20px;
}

/* ç½‘æ ¼å¸ƒå±€ä¼˜åŒ– */
.grid { 
  display: grid; 
  gap: 20px; 
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
}

.row { 
  display: grid; 
  gap: 20px; 
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
  align-items: end; 
  margin-top: 12px;
}

label { 
  display: block; 
  font-size: 14px; 
  color: var(--muted); 
  margin-bottom: 6px;
  font-weight: 500;
}

/* è¾“å…¥æ¡†/ä¸‹æ‹‰æ¡†æ ·å¼ä¼˜åŒ– */
input[type="text"], input[type="date"], input[type="number"], textarea, select { 
  width: 100%; 
  padding: 12px 16px; 
  border: 1px solid var(--line); 
  border-radius: var(--radius-sm); 
  font-size: 16px; 
  height: 48px; 
  transition: var(--transition);
  color: var(--ink);
}

input:focus, select:focus, textarea:focus { 
  outline: none; 
  border-color: var(--primary); 
  box-shadow: 0 0 0 3px var(--tertiary); 
}

/* è¡¨æ ¼æ ·å¼ä¼˜åŒ– */
table { 
  width: 100%; 
  border-collapse: separate; 
  border-spacing: 0; 
  margin-top: 16px; 
  border: 1px solid var(--line); 
  border-radius: var(--radius-sm); 
  overflow: hidden;
}

th, td { 
  border-bottom: 1px solid var(--line); 
  border-right: 1px solid var(--line); 
  padding: 12px 16px; 
  text-align: left; 
  vertical-align: middle;
}

th:last-child, td:last-child { border-right: none; }
tr:last-child td { border-bottom: none; }

thead th { 
  background: var(--light-gray); 
  color: var(--ink); 
  font-weight: 600; 
  font-size: 14px; 
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* è¡¨æ ¼è¡Œäº¤äº’ */
tbody tr:hover { background-color: var(--primary-light); transition: var(--transition); }

.right { text-align: right; color: var(--secondary); font-weight: 500; }

.note { 
  margin-top: 12px; 
  color: var(--muted); 
  font-size: 13px; 
  line-height: 1.4;
  padding-left: 20px;
  position: relative;
}

.note::before { 
  content: "â„¹ï¸"; 
  position: absolute; 
  left: 0; 
  top: 0;
}

/* åˆ†ç»„æ ‡é¢˜æ ·å¼ï¼ˆæ¥æºèœå•ï¼‰ */
.group-header td { 
  background: var(--primary-light); 
  font-weight: 700; 
  font-size: 15px; 
  padding: 12px 16px; 
  color: var(--primary); 
  border-width: 1px 0; 
  border-color: var(--line); 
}

/* ç»†èŠ‚ä¼˜åŒ–ï¼šåˆ é™¤æŒ‰é’® */
.btn-del { 
  padding: 6px 12px; 
  border: 1px solid var(--danger); 
  border-radius: var(--radius-sm); 
  background: #fff; 
  color: var(--danger); 
  cursor: pointer; 
  transition: var(--transition);
  font-size: 14px;
}

.btn-del:hover { 
  background: var(--danger); 
  color: #fff; 
}

/* æ€»ä»·åŒºåŸŸæ ·å¼ */
#subtotal, #grand { font-size: 18px; font-weight: 700; }
#grand { color: var(--primary); font-size: 20px; }

/* æ¥æºèœå•æŠ˜å é¢æ¿ */
details { 
  margin-top: 20px; 
  border-radius: var(--radius); 
  border: 1px solid var(--line); 
  overflow: hidden;
}

summary { 
  padding: 16px 20px; 
  background: var(--light-gray); 
  cursor: pointer; 
  list-style: none; 
  font-weight: 600;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

summary::after { content: "â–¼"; font-size: 14px; transition: var(--transition); }
details[open] summary::after { transform: rotate(180deg); }

/* å“åº”å¼ä¼˜åŒ– */
@media (max-width: 768px) {
  header { padding: 16px 20px; gap: 16px; }
  h1 { font-size: 20px; }
  main { padding: 20px 16px; }
  .grid, .row { gap: 16px; }
  .block { padding: 16px; }
  th, td { padding: 10px 12px; }
  .toolbar button, #btn-add { padding: 10px 16px; font-size: 14px; }
}

@media print { 
  .toolbar, .btn-row, details { display: none !important; } 
  .container { margin: 0; border: none; border-radius: 0; box-shadow: none; } 
  header { background: #fff; border-bottom: none; }
  h1 { color: var(--ink); }
}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>æ­£é¤é¤ç›’å ±åƒ¹å–®ï¼ˆäº’å‹•ç‰ˆï½œå±¤ç´šä¸‹æ‹‰ + Excel åŒ¯å‡ºï¼‰</h1>
        <div class="muted">å…ˆé¸ã€Œ<b>ä¾¿ç•¶ç¨®é¡</b>ï¼ˆé¤ç›’é¡åˆ¥ï¼‰ã€â†’ å†é¸ã€Œé¤ç›’ç¨®é¡ã€ã€‚åŠ å…¥æ˜ç´°å¾Œå¯ä¸‹è¼‰ Excelã€‚â€» åƒ…å¼•ç”¨ä¸‹æ–¹ä¾†æºèœå–®çš„å¯¦éš›é …ç›®ï¼Œä¸æ–°å¢ä¸å­˜åœ¨èœè‰²ã€‚</div>
      </div>
      <div class="toolbar">
        <button onclick="generateExcel()">ä¸‹è¼‰ Excel (.xlsx)</button>
      </div>
    </header>

    <main>
      <!-- åŸºæœ¬è³‡è¨Š -->
      <section class="grid">
        <div class="block">
          <label>å®¢æˆ¶åç¨±</label>
          <input id="client" type="text" placeholder="è«‹è¼¸å…¥å®¢æˆ¶åç¨±">
        </div>
        <div class="block">
          <label>å ±åƒ¹æ—¥æœŸ</label>
          <input id="date" type="date">
        </div>
      </section>

      <!-- å±¤ç´šä¸‹æ‹‰ï¼ˆé¸å“ï¼‰ -->
      <section class="block" style="margin-top:12px">
        <label style="font-weight:600;color:#374151">å¿«é€Ÿé¸å“ï¼ˆå±¤ç´šä¸‹æ‹‰ï¼‰</label>
        <div class="row">
          <div>
            <label>ä¾¿ç•¶ç¨®é¡ï¼ˆé¤ç›’é¡åˆ¥ï¼‰</label>
            <select id="sel-category"><option value="" disabled selected>è«‹é¸æ“‡ä¾¿ç•¶ç¨®é¡</option></select>
          </div>
          <div>
            <label>é¤ç›’ç¨®é¡</label>
            <select id="sel-item" disabled><option value="" disabled selected>è«‹å…ˆé¸ä¾¿ç•¶ç¨®é¡</option></select>
          </div>
          <div>
            <label>å–®åƒ¹ï¼ˆè‡ª Excel è‡ªå‹•å¸¶å…¥ï¼‰</label>
            <input id="sel-price" type="number" min="0" step="1" value="0" readonly>
          </div>
          <div>
            <label>æ•¸é‡</label>
            <input id="sel-qty" type="number" min="1" step="1" value="1">
          </div>
          <div>
            <button id="btn-add" style="width:100%">åŠ å…¥æ˜ç´°</button>
          </div>
        </div>
        <div class="note">åƒ¹æ ¼æœƒä¾ <b>æœ¨äººè‰¸å ±åƒ¹å–®(æ­£é¤é¤ç›’å»ºè­°).xlsx</b> è‡ªå‹•å¡«å…¥ï¼›è‹¥ Excel æ‰¾ä¸åˆ°å®Œå…¨ç›¸åŒçš„å“åï¼Œæœƒä¿ç•™ 0ï¼ˆé¿å…èª¤å ±åƒ¹ï¼‰ã€‚</div>
      </section>

      <!-- å·²é¸æ˜ç´° -->
      <section class="block" style="margin-top:12px">
        <label style="font-weight:600;color:#374151">è¨‚å–®æ˜ç´°</label>
        <table id="order-table">
          <thead>
            <tr>
              <th>é …ç›®åç¨±ï¼ˆä¸»èœï¼‰èˆ‡å…§å®¹</th>
              <th class="right" style="width:120px">å–®åƒ¹</th>
              <th class="right" style="width:100px">æ•¸é‡</th>
              <th class="right" style="width:140px">å°è¨ˆ</th>
              <th style="width:60px"></th>
            </tr>
          </thead>
          <tbody id="order-tbody"></tbody>
        </table>
        <div class="grid" style="margin-top:10px; grid-template-columns: 1fr 280px; align-items:start">
          <div class="note">é‡‘é¡åƒ…ä¾›è©¦ç®—ï¼Œå¯¦éš›ä»¥åˆç´„æˆ–æœ€çµ‚å ±åƒ¹ç‚ºæº–ã€‚</div>
          <div>
            <div style="display:grid; gap:6px; justify-content:end">
              <div style="display:grid; grid-template-columns: 1fr 140px; gap:8px"><div>å°è¨ˆ</div><div class="right" id="subtotal">0</div></div>
              <div style="display:grid; grid-template-columns: 1fr 140px; gap:8px; font-weight:700"><div>ç¸½è¨ˆ</div><div class="right" id="grand">0</div></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ä¾†æºèœå–®ï¼ˆä½œç‚ºè³‡æ–™ä¾†æºï¼›å¯æ”¶åˆï¼‰ -->
      <details style="margin-top:12px; display:none">
        <summary class="block" style="cursor:pointer; list-style:none">ä¾†æºèœå–®ï¼ˆé»æˆ‘å±•é–‹/æ”¶åˆï¼‰</summary>
        <div class="block" style="border-top:0; border-top-left-radius:0; border-top-right-radius:0">
          <table class="table-grid">
            <thead>
              <tr>
                <th>é …ç›®åç¨±ï¼ˆä¸»èœï¼‰èˆ‡å…§å®¹</th>
                <th class="right" style="width:120px">å–®åƒ¹</th>
                <th class="right" style="width:120px">æ•¸é‡</th>
                <th class="right" style="width:140px">å°è¨ˆ</th>
              </tr>
            </thead>
            <tbody id="items-body">
              <!-- ä¾†æºè¡¨æ ¼é–‹å§‹ -->
              <tr class="group-header"><td colspan="4">ğŸ± äºŒæ ¼ç›’ (é›™æ ¼ç›’ $180-200)</td></tr>
              <tr data-index="0"><td><div class="name-wrap"><input class="name" value="ç¨å®¶é¦™æ–™é¹¹è±¬è‚‰"><div class="meta">äºŒæ ¼ç›’  </div><ul class="includes"><li>é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬</li><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="1"><td><div class="name-wrap"><input class="name" value="æ—¥å¼é¹½éº´è±¬äº”èŠ±"><div class="meta">äºŒæ ¼ç›’  </div><ul class="includes"><li>é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬</li><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="2"><td><div class="name-wrap"><input class="name" value="æ—¥å¼é¹½éº´é›è…¿æ’"><div class="meta">äºŒæ ¼ç›’  </div><ul class="includes"><li>é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬</li><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="3"><td><div class="name-wrap"><input class="name" value="è”¥æ²¹é›èƒ¸è‚‰"><div class="meta">äºŒæ ¼ç›’  </div><ul class="includes"><li>é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬</li><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="4"><td><div class="name-wrap"><input class="name" value="æ³•å¼æ²¹å°æé®‘è‡(å…¨ç´ )"><div class="meta">äºŒæ ¼ç›’  </div><ul class="includes"><li>é…èœ: ç¶œåˆæº«ä»€è”¬ä½æ²¹é†‹é†¬(å…¨ç´ )</li><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹(è›‹å¥¶ç´ )</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯(å…¨ç´ )</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>

              <tr class="group-header"><td colspan="4">ğŸ± æ¤çº–å››æ ¼ç›’ (ç´…è—œç§ˆç±³é£¯çµ„åˆ)</td></tr>
              <tr data-index="7"><td><div class="name-wrap"><input class="name" value="è‡ªè£½è”¥æ²¹é›èƒ¸è‚‰ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)"><div class="meta">æ¤çº–å››æ ¼ç›’  </div><ul class="includes"><li>é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬</li><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="7"><td><div class="name-wrap"><input class="name" value="æ—¥å¼é¹½éº´é›è…¿æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)"><div class="meta">æ¤çº–å››æ ¼ç›’ </div><ul class="includes"><li>é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬</li><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="7"><td><div class="name-wrap"><input class="name" value="è’²ç‡’é¯›é­šè…¹æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)"><div class="meta">æ¤çº–å››æ ¼ç›’ </div><ul class="includes"><li>é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬</li><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="7"><td><div class="name-wrap"><input class="name" value="é¯–é­šä¸€å¤œå¹² + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)"><div class="meta">æ¤çº–å››æ ¼ç›’ </div><ul class="includes"><li>é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬</li><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="7"><td><div class="name-wrap"><input class="name" value="ç‚­çƒ¤ç‰›å°æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)"><div class="meta">æ¤çº–å››æ ¼ç›’ </div><ul class="includes"><li>é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬</li><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="7"><td><div class="name-wrap"><input class="name" value="æ—¥å¼ç‰›è‚‰æ¼¢å ¡æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)"><div class="meta">æ¤çº–å››æ ¼ç›’ </div><ul class="includes"><li>é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬</li><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="7"><td><div class="name-wrap"><input class="name" value="æ³•å¼æ²¹å°æé®‘è‡ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)"><div class="meta">æ¤çº–å››æ ¼ç›’ </div><ul class="includes"><li>é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬</li><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>

              <tr class="group-header"><td colspan="4">ğŸ± éŸ“å¼å…«æ ¼ç›’</td></tr>
              <tr data-index="23"><td><div class="name-wrap"><input class="name" value="éŸ“å¼ç‚¸é› + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)"><div class="meta">éŸ“å¼å…«æ ¼ç›’ </div><ul class="includes"><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>é…èœ: éŸ“å¼æ³¡èœ</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="23"><td><div class="name-wrap"><input class="name" value="æ—¥å¼é¹½éº´é›è…¿æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)"><div class="meta">éŸ“å¼å…«æ ¼ç›’ </div><ul class="includes"><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>é…èœ: éŸ“å¼æ³¡èœ</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="23"><td><div class="name-wrap"><input class="name" value="ç‚­çƒ¤ç‰›å°æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)"><div class="meta">éŸ“å¼å…«æ ¼ç›’ </div><ul class="includes"><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>é…èœ: éŸ“å¼æ³¡èœ</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="23"><td><div class="name-wrap"><input class="name" value="æ—¥å¼ç‰›è‚‰æ¼¢å ¡æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)"><div class="meta">éŸ“å¼å…«æ ¼ç›’ </div><ul class="includes"><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>é…èœ: éŸ“å¼æ³¡èœ</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="23"><td><div class="name-wrap"><input class="name" value="è’²ç‡’é¯›é­šè…¹æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)"><div class="meta">éŸ“å¼å…«æ ¼ç›’ </div><ul class="includes"><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>é…èœ: éŸ“å¼æ³¡èœ</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="23"><td><div class="name-wrap"><input class="name" value="é¯–é­šä¸€å¤œå¹² + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)"><div class="meta">éŸ“å¼å…«æ ¼ç›’ </div><ul class="includes"><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>é…èœ: éŸ“å¼æ³¡èœ</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <tr data-index="23"><td><div class="name-wrap"><input class="name" value="æ³•å¼æ²¹å°æé®‘è‡ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)"><div class="meta">éŸ“å¼å…«æ ¼ç›’ </div><ul class="includes"><li>é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹</li><li>é…èœ: éŸ“å¼æ³¡èœ</li><li>ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯</li></ul></div></td><td class="right"><input class="price" type="number" min="0" step="1" value="0"></td><td class="right"><input class="qty" type="number" min="0" step="1" value="0"></td><td class="right line-subtotal">0</td></tr>
              <!-- ä¾†æºè¡¨æ ¼çµæŸ -->
            </tbody>
          </table>
          <div class="note">æ­¤å€ç‚ºã€Œä¾†æºèœå–®ã€ï¼Œæä¾›ä¸‹æ‹‰çš„è³‡æ–™ä¾†æºèˆ‡ç´°ç¯€æè¿°ï¼›å¯ç…§å¯¦éš›ä¾›æ‡‰æ›´æ–°ã€‚åƒ¹æ ¼ä¾†æºï¼š/mnt/data/æœ¨äººè‰¸å ±åƒ¹å–®(æ­£é¤é¤ç›’å»ºè­°).xlsxã€‚</div>
        </div>
      </details>

    </main>
  </div>

<script>
  // åƒ¹æ ¼æ˜ å°„ï¼ˆç”± Excel è§£æå¾—å‡ºï¼›åªå°ã€Œå®Œå…¨ç›¸åŒå“åã€è‡ªå‹•å¸¶å…¥ï¼‰
  const PRICE_MAP = {"sheets":{"é›™æ ¼ç›’ $180-200":{"ç¨å®¶é¦™æ–™é¹¹è±¬è‚‰":200,"æ—¥å¼é¹½éº´è±¬äº”èŠ±":200,"æ—¥å¼é¹½éº´é›è…¿æ’":200,"è”¥æ²¹é›èƒ¸è‚‰":180,"æ³•å¼æ²¹å°æé®‘è‡(å…¨ç´ )":180},"æ¤çº–4æ ¼ $300":{"é¯–é­šä¸€å¤œå¹²":320,"ç‚­çƒ¤ç‰›å°æ’":420,"æ—¥å¼ç‰›è‚‰æ¼¢å ¡æ’":320,"æ³•å¼æ²¹å°æé®‘è‡":320},"æ¤çº–4æ ¼ $300 (è¥¿å¼)":{"é¯–é­šä¸€å¤œå¹²":320,"ç‚­çƒ¤ç‰›å°æ’":420,"æ—¥å¼ç‰›è‚‰æ¼¢å ¡æ’":320,"æ³•å¼æ²¹å°æé®‘è‡":320},"æ¤çº–æµ·é™¸ $599":{"æ³•å¼æ²¹å°æé®‘è‡":599}},"flat":{
    /* --- äºŒæ ¼ç›’ --- */
    "ç¨å®¶é¦™æ–™é¹¹è±¬è‚‰":200,
    "æ—¥å¼é¹½éº´è±¬äº”èŠ±":200,
    "æ—¥å¼é¹½éº´é›è…¿æ’":200,
    "è”¥æ²¹é›èƒ¸è‚‰":180,
    "æ³•å¼æ²¹å°æé®‘è‡(å…¨ç´ )":180,

    /* --- æ¤çº–å››æ ¼ç›’ --- */
    "è‡ªè£½è”¥æ²¹é›èƒ¸è‚‰ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 300,
    "æ—¥å¼é¹½éº´é›è…¿æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 320,
    "è’²ç‡’é¯›é­šè…¹æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 320,
    "é¯–é­šä¸€å¤œå¹² + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 320,
    "ç‚­çƒ¤ç‰›å°æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 420,
    "æ—¥å¼ç‰›è‚‰æ¼¢å ¡æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 320,
    "æ³•å¼æ²¹å°æé®‘è‡ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 320,

    /* --- éŸ“å¼å…«æ ¼ç›’ --- */
    "éŸ“å¼ç‚¸é› + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 280,
    "æ—¥å¼é¹½éº´é›è…¿æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 280,
    "ç‚­çƒ¤ç‰›å°æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 380,
    "æ—¥å¼ç‰›è‚‰æ¼¢å ¡æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 280,
    "è’²ç‡’é¯›é­šè…¹æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 280,
    "é¯–é­šä¸€å¤œå¹² + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 280,
    "æ³•å¼æ²¹å°æé®‘è‡ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 280
}};

  const $ = (s, el=document) => el.querySelector(s);
  const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));
  const money = n => new Intl.NumberFormat('zh-Hant', { maximumFractionDigits: 0 }).format(n||0);

  // å°‡ group header æ¨™é¡Œæ•´ç†æˆã€Œä¾¿ç•¶ç¨®é¡ã€ï¼ˆå»æ‰ emojièˆ‡æ‹¬è™Ÿèªªæ˜ï¼‰
  function normalizeCategory(raw) {
    const t = String(raw).replace('ğŸ±','').trim();
    if (/æµ·é™¸/.test(t)) return 'æ¤çº–å››æ ¼ç›’æµ·é™¸é¤';
    if (/éŸ“å¼å…«æ ¼ç›’/.test(t)) return 'éŸ“å¼å…«æ ¼ç›’';
    if (/äºŒæ ¼ç›’/.test(t)) return 'äºŒæ ¼ç›’';
    if (/æ¤çº–å››æ ¼ç›’/.test(t)) return 'æ¤çº–å››æ ¼ç›’';
    return t.split('(')[0].trim() || t;
  }

  // 1) ç”±ã€Œä¾†æºèœå–®ã€å‹•æ…‹å»ºæ§‹ Catalog
  const catalog = []; // {id, groupRaw, category, name, meta, includes[]}
  (function buildCatalog(){
    const rows = $$('#items-body tr');
    let curGroupRaw = '';
    let curCategory = '';
    rows.forEach(tr => {
      if (tr.classList.contains('group-header')) {
        const title = tr.textContent;
        curGroupRaw = title;
        curCategory = normalizeCategory(title);
      } else {
        const id = tr.getAttribute('data-index');
        const name = tr.querySelector('.name').value.trim();
        const meta = tr.querySelector('.meta')?.textContent.trim() || '';
        const includes = $$('.includes li', tr).map(li => li.textContent.trim());
        catalog.push({ id, groupRaw: curGroupRaw, category: curCategory, name, meta, includes });
      }
    });
  })();

  // 2) åˆå§‹åŒ–å±¤ç´šä¸‹æ‹‰ï¼ˆä¾¿ç•¶ç¨®é¡ â†’ é¤ç›’ç¨®é¡ï¼‰
  const selCategory = $('#sel-category');
  const selItem = $('#sel-item');
  const selPrice = $('#sel-price');
  const selQty = $('#sel-qty');
  const orderTbody = $('#order-tbody');

  const preferredOrder = ['äºŒæ ¼ç›’', 'æ¤çº–å››æ ¼ç›’', 'æ¤çº–å››æ ¼ç›’æµ·é™¸é¤', 'éŸ“å¼å…«æ ¼ç›’'];
  const categories = [...new Set(catalog.map(x => x.category))];
  categories.sort((a,b)=>{
    const ia = preferredOrder.indexOf(a), ib = preferredOrder.indexOf(b);
    if (ia !== -1 && ib !== -1) return ia - ib;
    if (ia !== -1) return -1;
    if (ib !== -1) return 1;
    return a.localeCompare(b,'zh-Hant');
  });
  categories.forEach(c => { const opt = document.createElement('option'); opt.value=c; opt.textContent=c; selCategory.appendChild(opt); });

  // ä¼˜åŒ–ä¸‹æ‹‰é€‰æ‹©ä½“éªŒï¼šé€‰æ‹©ç±»åˆ«åè‡ªåŠ¨èšç„¦åˆ°é¤ç›’é€‰æ‹©
  selCategory.addEventListener('change', () => {
    selItem.innerHTML = '<option value="" disabled selected>è«‹é¸æ“‡ç¨®é¡</option>';
    selItem.disabled = !selCategory.value;
    if (selCategory.value) {
      catalog.filter(x => x.category === selCategory.value).forEach(item => {
        const opt = document.createElement('option');
        opt.value = item.id; 
        opt.textContent = item.name; 
        selItem.appendChild(opt);
      });
      // è‡ªåŠ¨èšç„¦åˆ°é¤ç›’é€‰æ‹©æ¡†
      selItem.focus();
    }
  });

  function getAutoPriceByName(name){
    if (PRICE_MAP && PRICE_MAP.flat && Object.prototype.hasOwnProperty.call(PRICE_MAP.flat, name)) {
      return PRICE_MAP.flat[name];
    }
    return null;
  }

  // å®‰å…¨çš„æè¿°çµ„è£
  function buildDesc(item){
    const parts = [item.name];
    if (item.meta) parts.push(item.meta);
    if (item.includes && item.includes.length) {
      parts.push(...item.includes.map(v => `  - ${v}`));
    }
    return parts.join('\n');
  }

  selItem.addEventListener('change', () => {
    const item = catalog.find(x => x.id === selItem.value);
    if (!item) return;
    const p = getAutoPriceByName(item.name);
    if (p != null) selPrice.value = p; else selPrice.value = 0;
  });

  // 3) åŠ å…¥æ˜ç´° + è¨ˆç®—
  function recalc(){
    let subtotal = 0;
    $$('#order-tbody tr').forEach(tr => {
      const price = Number(tr.dataset.price||0);
      const qty = Number(tr.dataset.qty||0);
      const line = price * qty;
      subtotal += line;
      tr.querySelector('.line-subtotal').textContent = money(line);
    });
    $('#subtotal').textContent = money(subtotal);
    $('#grand').textContent = money(subtotal);
  }

  function addRow({ itemId, price, qty }){
    const item = catalog.find(x => x.id === itemId);
    if (!item) return;
    const desc = buildDesc(item);
    const tr = document.createElement('tr');
    tr.dataset.price = String(price);
    tr.dataset.qty = String(qty);
    tr.dataset.group = item.category;
    tr.dataset.itemId = item.id;
    tr.innerHTML = `
      <td style="white-space:pre-wrap">${desc}</td>
      <td class="right">${money(price)}</td>
      <td class="right">${money(qty)}</td>
      <td class="right line-subtotal">0</td>
      <td class="right"><button type="button" class="btn-del" style="padding:6px 10px;border:1px solid var(--line);border-radius:10px;background:#fff">åˆªé™¤</button></td>
    `;
    // ä¿®æ”¹åˆ é™¤æŒ‰é’®é€»è¾‘ï¼šå¢åŠ ç¡®è®¤æç¤º
    tr.querySelector('.btn-del').addEventListener('click', () => {
      if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${item.name}ã€é€™é …å—ï¼Ÿ`)) {
        tr.remove(); 
        recalc(); 
      }
    });
    // æ·»åŠ è¡Œæ—¶çš„å¹³æ»‘åŠ¨ç”»
    tr.style.opacity = '0';
    tr.style.transform = 'translateY(10px)';
    orderTbody.appendChild(tr);
    setTimeout(() => {
      tr.style.opacity = '1';
      tr.style.transform = 'translateY(0)';
      tr.style.transition = 'all 0.2s ease';
    }, 10);
    recalc();
  }

  $('#btn-add').addEventListener('click', () => {
    const group = selCategory.value;
    const itemId = selItem.value;
    if (!group) { alert('è«‹å…ˆé¸æ“‡ã€Œä¾¿ç•¶ç¨®é¡ã€'); return; }
    if (!itemId) { alert('è«‹é¸æ“‡ã€Œé¤ç›’ç¨®é¡ã€'); return; }
    const price = Number(selPrice.value||0);
    const qty = Number(selQty.value||1);
    addRow({ itemId, price, qty });
    
    // æ·»åŠ åæ¸…ç©ºæ•°é‡è¾“å…¥æ¡†ï¼ˆæ–¹ä¾¿ä¸‹æ¬¡è¾“å…¥ï¼‰
    selQty.value = 1;
  });

  // 4) Excel åŒ¯å‡º
  function generateExcel(){
    const client = $('#client').value || 'å®¢æˆ¶';
    const date = $('#date').value;
    const filename = `å ±åƒ¹å–®_${client}_${date||new Date().toISOString().slice(0,10)}.xlsx`;

    const rows = [];
    rows.push(['æ­£é¤é¤ç›’å ±åƒ¹å–®']);
    rows.push([null]);
    rows.push(['å®¢æˆ¶åç¨±', client]);
    rows.push(['å ±åƒ¹æ—¥æœŸ', date]);
    rows.push([null]);
    rows.push(['é …ç›®åç¨±ï¼ˆä¸»èœï¼‰èˆ‡å…§å®¹','å–®åƒ¹','æ•¸é‡','å°è¨ˆ']);

    // ä¾ã€Œä¾¿ç•¶ç¨®é¡ã€åˆ†çµ„è¼¸å‡º
    const items = $$('#order-tbody tr').map(tr => ({
      group: tr.dataset.group,
      desc: tr.children[0].textContent,
      price: Number(tr.dataset.price||0),
      qty: Number(tr.dataset.qty||0),
      subtotal: Number(tr.dataset.price||0) * Number(tr.dataset.qty||0)
    }));

    const byGroup = {};
    items.forEach(it => { (byGroup[it.group] ||= []).push(it); });
    Object.keys(byGroup).forEach(g => {
      rows.push([`--- ${g} ---`, null, null, null]);
      byGroup[g].forEach(it => rows.push([it.desc, it.price, it.qty, it.subtotal]));
    });

    // å°è¨ˆ/ç¸½è¨ˆ
    const total = items.reduce((a,b)=>a+b.subtotal,0);
    rows.push([null]);
    rows.push([null,null,'å°è¨ˆ', total]);
    rows.push([null,null,'ç¸½è¨ˆ', total]);

    const ws = XLSX.utils.aoa_to_sheet(rows);
    ws['!cols'] = [{wch:64},{wch:10},{wch:10},{wch:14}];
    ws['!merges'] = [ { s:{r:0,c:0}, e:{r:0,c:3} } ];

    const headerRows = 6;
    rows.forEach((r, i) => {
      if (i >= headerRows && i < rows.length - 3) {
        const cellA = `A${i+1}`;
        if (r[1] !== null) {
          if (ws[cellA]) ws[cellA].s = { alignment:{ wrapText:true, vertical:'top' } };
        } else {
          // group æ¨™é¡Œ
          ws['!merges'].push({ s:{r:i,c:0}, e:{r:i,c:3} });
          if (ws[cellA]) ws[cellA].s = { font:{bold:true}, alignment:{ horizontal:'center' } };
        }
      }
    });

    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'å ±åƒ¹å–®');
    XLSX.writeFile(wb, filename);
  }
  window.generateExcel = generateExcel;

  // 5) åˆå§‹åŒ–ï¼šæ—¥æœŸ
  (function initMeta(){
    const today = new Date();
    $('#date').value = new Date(today.getTime() - today.getTimezoneOffset()*60000).toISOString().slice(0,10);
  })();

  // 6) ä¼˜åŒ–é‡‘é¢è¾“å…¥ï¼šç¦æ­¢è¾“å…¥è´Ÿæ•°
  selPrice.addEventListener('input', (e) => {
    e.target.value = e.target.value.replace(/[^0-9]/g, ''); // åªå…è®¸æ•°å­—
  });

  // 7) é¡µé¢åŠ è½½å®Œæˆåçš„æ¬¢è¿æç¤º
  window.addEventListener('load', () => {
    console.log('ğŸ“‹ å ±åƒ¹å–®é é¢å·²æº–å‚™å°±ç·’ï¼è«‹å…ˆè¼¸å…¥å®¢æˆ¶è³‡è¨Šï¼Œå†é¸æ“‡é¤ç›’ç¨®é¡');
    // è‡ªåŠ¨èšç„¦åˆ°å®¢æˆ·åç§°è¾“å…¥æ¡†
    $('#client').focus();
  });

  // 8) è‡ªå‹•åŒ–æ¸¬è©¦ï¼ˆConsoleï¼‰
  (function runTests(){
    try {
      console.assert(Array.isArray(catalog) && catalog.length > 0, 'catalog æ‡‰è©²å»ºç«‹æˆåŠŸ');
      const cats = [...new Set(catalog.map(x=>x.category))];
      console.assert(cats.includes('äºŒæ ¼ç›’'), 'æ‡‰åŒ…å«ã€ŒäºŒæ ¼ç›’ã€');
      console.assert(cats.includes('éŸ“å¼å…«æ ¼ç›’'), 'æ‡‰åŒ…å«ã€ŒéŸ“å¼å…«æ ¼ç›’ã€');
      console.assert(PRICE_MAP.flat['è”¥æ²¹é›èƒ¸è‚‰'] === 180, 'Excel å–®åƒ¹æ‡‰ç‚º 180');
      const item = catalog.find(x => x.name === 'è”¥æ²¹é›èƒ¸è‚‰');
      if (item) {
        const autoPrice = PRICE_MAP.flat[item.name] ?? null;
        console.assert(autoPrice === 180, 'ä¸‹æ‹‰æ‡‰å¸¶å…¥ 180');
      }
      const combo = catalog.find(x => x.name.includes(' + '));
      if (combo) {
        const p = PRICE_MAP.flat[combo.name] ?? null;
        console.assert(p == null, 'Excel æœªå®šç¾©çš„çµ„åˆé¤ä¸æ‡‰è‡ªå‹•å®šåƒ¹');
      }
      const d = buildDesc({ name:'æ¸¬è©¦ä¸»èœ', meta:'äºŒæ ¼ç›’', includes:['é…èœ: A','é…èœ: B'] });
      console.assert(/\n  - é…èœ: A/.test(d) && /\n  - é…èœ: B/.test(d), 'buildDesc æ‡‰æ­£ç¢ºçµ„è£é…èœ');
      console.assert(getAutoPriceByName('ä¸å­˜åœ¨çš„å“å') == null, 'æœªçŸ¥å“åä¸å¯è‡ªå‹•å®šåƒ¹');

      console.log('%cAll tests passed','color:green');
    } catch (e) {
      console.error('Tests failed', e);
    }
  })();
</script>
</body>
</html>
