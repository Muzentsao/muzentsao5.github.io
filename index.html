<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>æœ¨äººè‰¸xæ­£é¤é¤ç›’å ±åƒ¹å–®</title>
<link rel="preconnect" href="https://cdnjs.cloudflare.com"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
:root { 
  --primary: #FF8C42; 
  --primary-light: #FFF0E6; 
  --secondary: #4CAF50; 
  --tertiary: #E3F2FD; 
  --ink: #2D3748; 
  --muted: #718096; 
  --light-gray: #F7FAFC; 
  --line: #E2E8F0; 
  --danger: #E53E3E; 
  --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
  --shadow: 0 4px 12px rgba(0,0,0,0.08);
  --radius: 16px; 
  --radius-sm: 12px; 
  --transition: all 0.2s ease; 
}

* { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; } /* åŠ å…¥å¹³æ»‘æ²å‹•æ•ˆæœ */

body { 
  font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", "Segoe UI", Roboto, Arial, "PingFang TC", "Microsoft JhengHei", sans-serif; 
  background: var(--light-gray); 
  color: var(--ink);
  line-height: 1.5;
}

/* åŸæœ¬çš„å®¹å™¨è¨­å®š (è¡¨å–®å€åŸŸ) */
.container { 
  max-width: 1200px; 
  margin: 0 auto 32px auto; /* ä¸Šæ–¹ margin æ”¹ç‚º 0ï¼Œå› ç‚ºä¸Šé¢æœ‰ Hero */
  background: #fff; 
  border-radius: var(--radius); 
  box-shadow: var(--shadow); 
  overflow: hidden; 
  border: 1px solid var(--line);
}  

/* èˆŠçš„ Header æ¨£å¼ä¿ç•™ä½†ç”¨ä¸åˆ°ï¼Œæ‚¨å¯ä»¥é¸æ“‡åˆªé™¤æˆ–ç•™è‘—å‚™ç”¨ */
header { 
  padding: 24px 32px; 
  border-bottom: 1px solid var(--line); 
  display: flex; 
  gap: 24px; 
  align-items: center; 
  justify-content: center; 
  flex-wrap: wrap; 
  background-color: var(--primary-light);
}

h1 { font-size: 24px; color: var(--primary); font-weight: 700; margin-bottom: 0; }

.muted { color: var(--muted); font-size: 14px; margin-top: 4px; }

#btn-download, #btn-add { 
  padding: 12px 20px; 
  border: none; 
  border-radius: var(--radius-sm); 
  background: var(--primary); 
  color: #fff; 
  cursor: pointer; 
  font-weight: 600;
  transition: var(--transition);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
#btn-download::before { content: "ğŸ“¥"; }
#btn-add::before { content: "â•"; }
#btn-download:hover, #btn-add:hover { background: #E07B39; transform: translateY(-2px); box-shadow: var(--shadow-sm); }
#btn-download:active, #btn-add:active { transform: translateY(0); }

main { padding: 28px 32px; }

.block { 
  border: 1px solid var(--line); 
  border-radius: var(--radius); 
  padding: 20px; 
  background-color: #fff;
  box-shadow: var(--shadow-sm);
  margin-bottom: 20px;
}

.grid { display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
.row { display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); align-items: end; margin-top: 12px; }

label { display: block; font-size: 14px; color: var(--muted); margin-bottom: 6px; font-weight: 500; }

input[type="text"], input[type="date"], input[type="number"], textarea, select { 
  width: 100%; 
  padding: 12px 16px; 
  border: 1px solid var(--line); 
  border-radius: var(--radius-sm); 
  font-size: 16px; 
  height: 48px; 
  transition: var(--transition);
  color: var(--ink);
}
input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px var(--tertiary); }

/* --- é è¦½å¡ç‰‡ä½ˆå±€ --- */
.selection-wrapper {
  display: flex;
  gap: 24px;
  align-items: start;
}
.selection-left { flex: 2; } 
.selection-right { 
  flex: 1; 
  min-width: 250px;
  background: var(--light-gray);
  border-radius: var(--radius);
  border: 1px solid var(--line);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.preview-box {
  flex-grow: 1;
  background: #eee;
  position: relative;
  height: 240px;      
  width: 100%;        
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  border-bottom: 1px solid var(--line); 
}
.preview-box img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: none; 
}
.preview-placeholder {
  color: var(--muted);
  font-size: 14px;
  text-align: center;
  line-height: 1.6;
}
.preview-info {
  padding: 16px;
  background: #fff;
  border-top: 1px solid var(--line);
}
.preview-title { font-weight: 700; color: var(--primary); margin-bottom: 4px; font-size: 16px; }
.preview-desc { font-size: 13px; color: var(--muted); line-height: 1.4; }

table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 16px; border: 1px solid var(--line); border-radius: var(--radius-sm); overflow: hidden; }
th, td { border-bottom: 1px solid var(--line); border-right: 1px solid var(--line); padding: 12px 16px; text-align: left; vertical-align: middle; }
th:last-child, td:last-child { border-right: none; }
tr:last-child td { border-bottom: none; }
thead th { background: var(--light-gray); color: var(--ink); font-weight: 600; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
tbody tr:hover { background-color: var(--primary-light); transition: var(--transition); }
.right { text-align: right; color: var(--secondary); font-weight: 500; }
.note { margin-top: 12px; color: var(--muted); font-size: 13px; line-height: 1.4; padding-left: 20px; position: relative; }
.note::before { content: "â„¹ï¸"; position: absolute; left: 0; top: 0; }
.btn-del { padding: 6px 12px; border: 1px solid var(--danger); border-radius: var(--radius-sm); background: #fff; color: var(--danger); cursor: pointer; transition: var(--transition); font-size: 14px; }
.btn-del:hover { background: var(--danger); color: #fff; }
#subtotal, #grand { font-size: 18px; font-weight: 700; }
#grand { color: var(--primary); font-size: 20px; }

@media (max-width: 768px) {
  /* Hero å€å¡Šæ‰‹æ©Ÿç‰ˆå„ªåŒ– */
  .hero-section { padding: 3rem 1.5rem !important; text-align: center; }
  .hero-text-area { text-align: center; margin-bottom: 2rem; }
  .hero-btn { width: 100%; text-align: center; }

  header { padding: 16px 20px; gap: 16px; }
  h1 { font-size: 20px; }
  main { padding: 20px 16px; }
  .grid, .row { gap: 16px; }
  .block { padding: 16px; }
  th, td { padding: 10px 12px; }
  #btn-download, #btn-add { padding: 10px 16px; font-size: 14px; }
  
  .selection-wrapper { flex-direction: column; }
  .selection-right { min-height: 250px; }
}

@media print { 
  .hero-section { display: none !important; } /* åˆ—å°æ™‚éš±è— Hero */
  .toolbar, .btn-row, details, #btn-download { display: none !important; } 
  .container { margin: 0; border: none; border-radius: 0; box-shadow: none; } 
  header { background: #fff; border-bottom: none; display: flex !important; } /* åˆ—å°æ™‚ä¿ç•™ç°¡å–®æ¨™é¡Œ */
  h1 { color: var(--ink); }
}
</style>
</head>
<body>

  <section class="hero-section" style="width:100%; background:#f9f7f4; padding:5rem 2rem; margin-bottom:2rem; position:relative; overflow:hidden;">
    <div style="position:absolute; top:-20%; right:-10%; width:40%; height:40%; background:#e8f4ea; border-radius:50%; opacity:0.6;"></div>
    <div style="position:absolute; bottom:-15%; left:-8%; width:30%; height:30%; background:#f0ebe2; border-radius:50%; opacity:0.6;"></div>
    
    <div style="max-width:1200px; margin:0 auto; position:relative; z-index:2;">
      <div style="display:flex; flex-wrap:wrap; align-items:center; gap:3rem;">
        
        <div class="hero-text-area" style="flex:1 1 500px;">
          <h1 style="font-size:2.8rem; color:#2d3748; margin:0 0 1rem 0; line-height:1.3; font-weight:700;">
            æœ¨äººè‰¸xæ­£é¤é¤ç›’<br>
            <span style="color:#FF8C42;">å¥åº·é£²é£Ÿï¼Œä¾¿æ·é€åˆ°å®¶</span>
          </h1>
          <p style="font-size:1.1rem; color:#4a5568; margin:0 0 1.5rem 0; line-height:1.6; max-width:600px;">
            ç²¾é¸æ–°é®®é£Ÿæï¼Œå¤šç¨®å¥—é¤é¸æ“‡ï¼ˆäºŒæ ¼ç›’/æ¤çº–å››æ ¼ç›’/éŸ“å¼ä¸ƒæ ¼ç›’ï¼‰ï¼Œé©åˆä¼æ¥­åœ˜é¤ã€æ´»å‹•ä¾›æ‡‰ã€åœ˜é«”è¨‚è³¼ã€‚
          </p>
          
          <div style="background: #fff; border-left: 4px solid #E53E3E; padding: 12px 16px; margin-bottom: 2rem; border-radius: 4px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
            <p style="margin:0; color:#E53E3E; font-weight:600; font-size: 1rem;">
              âš ï¸ å–®ç­†è¨‚å–®30ç›’ä»¥ä¸Šï¼Œå»ºè­°180å…ƒ/äººèµ·è·³<br>
              <span style="font-size:0.9em; color:#718096; font-weight:400;">(ä»¥ä¸Šå ±åƒ¹æœªç¨…ï¼Œä¸”æœªå«äº¤é€šè²»)</span>
            </p>
          </div>

          <a href="#order-form" class="hero-btn" style="display:inline-block; background:#FF8C42; color:white; padding:1rem 2.5rem; border-radius:50px; font-size:1.1rem; font-weight:600; text-decoration:none; transition:all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 140, 66, 0.3);">
            ç«‹å³é¸å“å ±åƒ¹ â–¼
          </a>
        </div>
        
        <div style="flex:1 1 400px; text-align:center;">
          <img src="iStock-1167505855.jpg" alt="æœ¨äººè‰¸æ­£é¤é¤ç›’å±•ç¤º" style="width:100%; max-width:500px; height:auto; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,0.1); object-fit: cover;">
        </div>
      </div>
    </div>
  </section>


  <div class="container" id="order-form">
    <main>
      <section class="grid">
        <div class="block">
          <label>å®¢æˆ¶åç¨±</label>
          <input id="client" type="text" placeholder="è«‹è¼¸å…¥å®¢æˆ¶åç¨±">
        </div>
        <div class="block">
          <label>å ±åƒ¹æ—¥æœŸ</label>
          <input id="date" type="date">
        </div>
      </section>

      <section class="block" style="margin-top:12px">
        <label style="font-weight:600;color:#374151; margin-bottom:12px; display:block">å¿«é€Ÿé¸å“ï¼ˆå±¤ç´šä¸‹æ‹‰ï¼‰</label>
        
        <div class="selection-wrapper">
          <div class="selection-left">
            <div class="row" style="margin-top:0">
              <div style="grid-column: 1 / -1">
                <label>ä¾¿ç•¶ç¨®é¡ï¼ˆé¤ç›’é¡åˆ¥ï¼‰</label>
                <select id="sel-category"><option value="" disabled selected>è«‹é¸æ“‡ä¾¿ç•¶ç¨®é¡</option></select>
              </div>
              <div style="grid-column: 1 / -1">
                <label>é¤ç›’ç¨®é¡</label>
                <select id="sel-item" disabled><option value="" disabled selected>è«‹å…ˆé¸ä¾¿ç•¶ç¨®é¡</option></select>
              </div>
              <div>
                <label>å–®åƒ¹</label>
                <input id="sel-price" type="number" min="0" step="1" value="0" readonly>
              </div>
              <div>
                <label>æ•¸é‡</label>
                <input id="sel-qty" type="number" min="1" step="1" value="1">
              </div>
              <div style="display:flex; align-items:end;">
                <button id="btn-add" style="width:100%; height:48px;">åŠ å…¥æ˜ç´°</button>
              </div>
            </div>
          </div>

          <div class="selection-right">
            <div class="preview-box">
              <div class="preview-placeholder" id="preview-placeholder">
                è«‹é¸æ“‡å·¦å´é¤é»<br>ä»¥æª¢è¦–åœ–ç‰‡èˆ‡å…§å®¹
              </div>
              <img id="preview-img" src="" alt="é¤é»é è¦½">
            </div>
            <div class="preview-info">
              <div class="preview-title" id="preview-title">--</div>
              <div class="preview-desc" id="preview-desc">é¸æ“‡é¤é»å¾Œå°‡é¡¯ç¤ºè©³ç´°é…èœå…§å®¹</div>
            </div>
          </div>
        </div>
      </section>

      <section class="block" style="margin-top:12px">
        <label style="font-weight:600;color:#374151">è¨‚å–®æ˜ç´°</label>
        <table id="order-table">
          <thead>
            <tr>
              <th>é …ç›®åç¨±ï¼ˆä¸»èœï¼‰èˆ‡å…§å®¹</th>
              <th class="right" style="width:120px">å–®åƒ¹</th>
              <th class="right" style="width:100px">æ•¸é‡</th>
              <th class="right" style="width:140px">å°è¨ˆ</th>
              <th style="width:60px"></th>
            </tr>
          </thead>
          <tbody id="order-tbody"></tbody>
        </table>
        
        <div class="grid" style="margin-top:10px; grid-template-columns: 1fr 280px; align-items:start">
          <div class="note">é‡‘é¡åƒ…ä¾›è©¦ç®—ï¼Œå¯¦éš›ä»¥åˆç´„æˆ–æœ€çµ‚å ±åƒ¹ç‚ºæº–ã€‚</div>
          <div>
            <div style="display:grid; gap:6px; justify-content:end">
              <div style="display:grid; grid-template-columns: 1fr 140px; gap:8px"><div>å°è¨ˆ</div><div class="right" id="subtotal">0</div></div>
              <div style="display:grid; grid-template-columns: 1fr 140px; gap:8px; font-weight:700"><div>ç¸½è¨ˆ</div><div class="right" id="grand">0</div></div>
            </div>
            <div style="margin-top: 16px;">
               <button id="btn-download" onclick="generateExcel()" style="width:100%">ä¸‹è¼‰ Excel (.xlsx)</button>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

<script>
  const PRICE_MAP = { sheets: {}, flat: {} };
  PRICE_MAP.flat = {
    "æ—¥å¼é¹½éº´è±¬äº”èŠ±": 200, "æ—¥å¼é¹½éº´é›è…¿æ’": 200, "è”¥æ²¹é›èƒ¸è‚‰": 180, "æ³•å¼æ²¹å°æé®‘è‡(å…¨ç´ )": 180,
    "è‡ªè£½è”¥æ²¹é›èƒ¸è‚‰ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 300, "æ—¥å¼é¹½éº´é›è…¿æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 320,
    "è’²ç‡’é¯›é­šè…¹æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 320, "é¯–é­šä¸€å¤œå¹² + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 320,
    "ç‚­çƒ¤ç‰›å°æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 420, "æ—¥å¼ç‰›è‚‰æ¼¢å ¡æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 320,
    "æ³•å¼æ²¹å°æé®‘è‡ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)": 320,
    "éŸ“å¼ç‚¸é› + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 280, "æ—¥å¼é¹½éº´é›è…¿æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 280,
    "ç‚­çƒ¤ç‰›å°æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 380, "æ—¥å¼ç‰›è‚‰æ¼¢å ¡æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 280,
    "è’²ç‡’é¯›é­šè…¹æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 280, "é¯–é­šä¸€å¤œå¹² + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 280,
    "æ³•å¼æ²¹å°æé®‘è‡ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)": 280
  };

  const $ = (s, el=document) => el.querySelector(s);
  const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));
  const money = n => new Intl.NumberFormat('zh-Hant', { maximumFractionDigits: 0 }).format(n||0);

  const catalog = [
    // ğŸ± äºŒæ ¼ç›’
    { id:'b2-2', category:'äºŒæ ¼ç›’', name:'æ—¥å¼é¹½éº´è±¬äº”èŠ±', image:'æ—¥å¼é¹½éº´è±¬äº”èŠ±_å·¥ä½œå€åŸŸ 1.jpg', meta:'äºŒæ ¼ç›’', includes:['é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬','é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'b2-3', category:'äºŒæ ¼ç›’', name:'æ—¥å¼é¹½éº´é›è…¿æ’', image:'æ—¥å¼é¹½éº´é›è…¿æ’_å·¥ä½œå€åŸŸ 1.jpg', meta:'äºŒæ ¼ç›’', includes:['é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬','é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'b2-4', category:'äºŒæ ¼ç›’', name:'è”¥æ²¹é›èƒ¸è‚‰', image:'è”¥æ²¹é›èƒ¸è‚‰_å·¥ä½œå€åŸŸ 1.jpg', meta:'äºŒæ ¼ç›’', includes:['é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬','é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'b2-5', category:'äºŒæ ¼ç›’', name:'æ³•å¼æ²¹å°æé®‘è‡(å…¨ç´ )', image:'æ³•å¼æ²¹å°æé®‘è‡(å…¨ç´ )_å·¥ä½œå€åŸŸ 1.jpg', meta:'äºŒæ ¼ç›’', includes:['é…èœ: ç¶œåˆæº«ä»€è”¬ä½æ²¹é†‹é†¬(å…¨ç´ )','é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹(è›‹å¥¶ç´ )','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯(å…¨ç´ )'] },

    // ğŸ± æ¤çº–å››æ ¼ç›’ (éƒ¨åˆ†ç¯„ä¾‹åœ–)
    { id:'p4-1', category:'æ¤çº–å››æ ¼ç›’', name:'è‡ªè£½è”¥æ²¹é›èƒ¸è‚‰ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)', image:'å››æ ¼ç›’_è‡ªè£½è”¥æ²¹é›èƒ¸è‚‰ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)_å·¥ä½œå€åŸŸ 1.jpg', meta:'æ¤çº–å››æ ¼ç›’', includes:['é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬','é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'p4-2', category:'æ¤çº–å››æ ¼ç›’', name:'æ—¥å¼é¹½éº´é›è…¿æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)', image:'å››æ ¼ç›’_æ—¥å¼é¹½éº´é›è…¿æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)_å·¥ä½œå€åŸŸ 1.jpg', meta:'æ¤çº–å››æ ¼ç›’', includes:['é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬','é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'p4-3', category:'æ¤çº–å››æ ¼ç›’', name:'è’²ç‡’é¯›é­šè…¹æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)', image:'å››æ ¼ç›’_è’²ç‡’é¯›é­šè…¹æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)_å·¥ä½œå€åŸŸ 1.jpg', meta:'æ¤çº–å››æ ¼ç›’', includes:['é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬','é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'p4-4', category:'æ¤çº–å››æ ¼ç›’', name:'é¯–é­šä¸€å¤œå¹² + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)', image:'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=600&q=80', meta:'æ¤çº–å››æ ¼ç›’', includes:['é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬','é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'p4-5', category:'æ¤çº–å››æ ¼ç›’', name:'ç‚­çƒ¤ç‰›å°æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)', image:'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=600&q=80', meta:'æ¤çº–å››æ ¼ç›’', includes:['é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬','é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'p4-6', category:'æ¤çº–å››æ ¼ç›’', name:'æ—¥å¼ç‰›è‚‰æ¼¢å ¡æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)', image:'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=600&q=80', meta:'æ¤çº–å››æ ¼ç›’', includes:['é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬','é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'p4-7', category:'æ¤çº–å››æ ¼ç›’', name:'æ³•å¼æ²¹å°æé®‘è‡ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(50G)', image:'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=600&q=80', meta:'æ¤çº–å››æ ¼ç›’', includes:['é…èœ: ç¶œåˆæº«ä»€è”¬ä½èƒ¡éº»é†¬','é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },

    // ğŸ± éŸ“å¼ä¸ƒæ ¼ç›’ (éƒ¨åˆ†ç¯„ä¾‹åœ–)
    { id:'k8-1', category:'éŸ“å¼ä¸ƒæ ¼ç›’', name:'éŸ“å¼ç‚¸é› + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)', image:'éŸ“å¼ç‚¸é› + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g).jpg', meta:'éŸ“å¼ä¸ƒæ ¼ç›’', includes:['é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','é…èœ: éŸ“å¼æ³¡èœ','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'k8-2', category:'éŸ“å¼ä¸ƒæ ¼ç›’', name:'æ—¥å¼é¹½éº´é›è…¿æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)', image:'æ—¥å¼é¹½éº´é›è…¿æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g).jpg', meta:'éŸ“å¼ä¸ƒæ ¼ç›’', includes:['é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','é…èœ: éŸ“å¼æ³¡èœ','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'k8-3', category:'éŸ“å¼ä¸ƒæ ¼ç›’', name:'ç‚­çƒ¤ç‰›å°æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)', image:'https://images.unsplash.com/photo-1623653387945-2fd25214f8fc?auto=format&fit=crop&w=600&q=80', meta:'éŸ“å¼ä¸ƒæ ¼ç›’', includes:['é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','é…èœ: éŸ“å¼æ³¡èœ','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'k8-4', category:'éŸ“å¼ä¸ƒæ ¼ç›’', name:'æ—¥å¼ç‰›è‚‰æ¼¢å ¡æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)', image:'https://images.unsplash.com/photo-1623653387945-2fd25214f8fc?auto=format&fit=crop&w=600&q=80', meta:'éŸ“å¼ä¸ƒæ ¼ç›’', includes:['é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','é…èœ: éŸ“å¼æ³¡èœ','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'k8-5', category:'éŸ“å¼ä¸ƒæ ¼ç›’', name:'è’²ç‡’é¯›é­šè…¹æ’ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)', image:'https://images.unsplash.com/photo-1623653387945-2fd25214f8fc?auto=format&fit=crop&w=600&q=80', meta:'éŸ“å¼ä¸ƒæ ¼ç›’', includes:['é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','é…èœ: éŸ“å¼æ³¡èœ','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'k8-6', category:'éŸ“å¼ä¸ƒæ ¼ç›’', name:'é¯–é­šä¸€å¤œå¹² + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)', image:'https://images.unsplash.com/photo-1623653387945-2fd25214f8fc?auto=format&fit=crop&w=600&q=80', meta:'éŸ“å¼ä¸ƒæ ¼ç›’', includes:['é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','é…èœ: éŸ“å¼æ³¡èœ','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
    { id:'k8-7', category:'éŸ“å¼ä¸ƒæ ¼ç›’', name:'æ³•å¼æ²¹å°æé®‘è‡ + æ—¥å¼é¹½éº´è±¬äº”èŠ±è‚‰(40g)', image:'https://images.unsplash.com/photo-1623653387945-2fd25214f8fc?auto=format&fit=crop&w=600&q=80', meta:'éŸ“å¼ä¸ƒæ ¼ç›’', includes:['é…èœ: æ—¥å¼å†·æ³¡æºå¿ƒè›‹','é…èœ: éŸ“å¼æ³¡èœ','ä¸»é£Ÿ: ç´…è—œç§ˆç±³é£¯'] },
  ];

  const selCategory = $('#sel-category');
  const selItem = $('#sel-item');
  const selPrice = $('#sel-price');
  const selQty = $('#sel-qty');
  const orderTbody = $('#order-tbody');
  
  const previewImg = $('#preview-img');
  const previewPlaceholder = $('#preview-placeholder');
  const previewTitle = $('#preview-title');
  const previewDesc = $('#preview-desc');

  const preferredOrder = ['äºŒæ ¼ç›’', 'æ¤çº–å››æ ¼ç›’', 'éŸ“å¼ä¸ƒæ ¼ç›’'];
  const categories = [...new Set(catalog.map(x => x.category))];
  categories.sort((a,b)=>{
    const ia = preferredOrder.indexOf(a), ib = preferredOrder.indexOf(b);
    if (ia !== -1 && ib !== -1) return ia - ib;
    if (ia !== -1) return -1;
    if (ib !== -1) return 1;
    return a.localeCompare(b,'zh-Hant');
  });
  categories.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c;
    opt.textContent = c;
    selCategory.appendChild(opt);
  });

  selCategory.addEventListener('change', () => {
    selItem.innerHTML = '<option value="" disabled selected>è«‹é¸æ“‡ç¨®é¡</option>';
    selItem.disabled = !selCategory.value;
    if (selCategory.value) {
      catalog.filter(x => x.category === selCategory.value).forEach(item => {
        const opt = document.createElement('option');
        opt.value = item.id;
        opt.textContent = item.name;
        selItem.appendChild(opt);
      });
      selItem.focus();
    }
    resetPreview();
  });

  function getAutoPriceByName(name){
    if (PRICE_MAP && PRICE_MAP.flat && Object.prototype.hasOwnProperty.call(PRICE_MAP.flat, name)) {
      return PRICE_MAP.flat[name];
    }
    return null;
  }

  function buildDesc(item){
    const parts = [item.name];
    if (item.meta) parts.push(item.meta);
    if (item.includes && item.includes.length) {
      parts.push(...item.includes.map(v => `  - ${v}`));
    }
    return parts.join('\n');
  }

  function resetPreview() {
    previewImg.style.display = 'none';
    previewPlaceholder.style.display = 'block';
    previewPlaceholder.innerHTML = 'è«‹é¸æ“‡å·¦å´é¤é»<br>ä»¥æª¢è¦–åœ–ç‰‡èˆ‡å…§å®¹';
    previewTitle.textContent = '--';
    previewDesc.textContent = 'é¸æ“‡é¤é»å¾Œå°‡é¡¯ç¤ºè©³ç´°é…èœå…§å®¹';
  }

  selItem.addEventListener('change', () => {
    const item = catalog.find(x => x.id === selItem.value);
    if (!item) {
      resetPreview();
      return;
    }
    
    const p = getAutoPriceByName(item.name);
    selPrice.value = (p != null) ? p : 0;

    previewTitle.textContent = item.name;
    previewDesc.innerHTML = item.includes ? item.includes.join('<br>') : item.meta;

    if (item.image) {
      previewImg.src = item.image;
      previewImg.style.display = 'block';
      previewPlaceholder.style.display = 'none';
    } else {
      previewImg.style.display = 'none';
      previewPlaceholder.style.display = 'block';
      previewPlaceholder.innerHTML = 'æ­¤é¤é»<br>æš«ç„¡åœ–ç‰‡';
    }
  });

  function recalc(){
    let subtotal = 0;
    $$('#order-tbody tr').forEach(tr => {
      const price = Number(tr.dataset.price||0);
      const qty = Number(tr.dataset.qty||0);
      const line = price * qty;
      subtotal += line;
      tr.querySelector('.line-subtotal').textContent = money(line);
    });
    $('#subtotal').textContent = money(subtotal);
    $('#grand').textContent = money(subtotal);
  }

  function addRow({ itemId, price, qty }){
    const item = catalog.find(x => x.id === itemId);
    if (!item) return;
    const desc = buildDesc(item);
    const tr = document.createElement('tr');
    tr.dataset.price = String(price);
    tr.dataset.qty = String(qty);
    tr.dataset.group = item.category;
    tr.dataset.itemId = item.id;
    tr.innerHTML = `
      <td style="white-space:pre-wrap">${desc}</td>
      <td class="right">${money(price)}</td>
      <td class="right">${money(qty)}</td>
      <td class="right line-subtotal">0</td>
      <td class="right"><button type="button" class="btn-del" style="padding:6px 10px;border:1px solid var(--line);border-radius:10px;background:#fff">åˆªé™¤</button></td>
    `;
    tr.querySelector('.btn-del').addEventListener('click', () => {
      if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${item.name}ã€é€™é …å—ï¼Ÿ`)) {
        tr.remove();
        recalc();
      }
    });
    tr.style.opacity = '0';
    tr.style.transform = 'translateY(10px)';
    orderTbody.appendChild(tr);
    setTimeout(() => {
      tr.style.opacity = '1';
      tr.style.transform = 'translateY(0)';
      tr.style.transition = 'all 0.2s ease';
    }, 10);
    recalc();
  }

  $('#btn-add').addEventListener('click', () => {
    const group = selCategory.value;
    const itemId = selItem.value;
    if (!group) { alert('è«‹å…ˆé¸æ“‡ã€Œä¾¿ç•¶ç¨®é¡ã€'); return; }
    if (!itemId) { alert('è«‹é¸æ“‡ã€Œé¤ç›’ç¨®é¡ã€'); return; }
    const price = Number(selPrice.value||0);
    const qty = Number(selQty.value||1);
    addRow({ itemId, price, qty });
    selQty.value = 1; 
  });

  function generateExcel(){
    const client = $('#client').value || 'å®¢æˆ¶';
    const date = $('#date').value;
    const filename = `å ±åƒ¹å–®_${client}_${date||new Date().toISOString().slice(0,10)}.xlsx`;

    const rows = [];
    rows.push(['æ­£é¤é¤ç›’å ±åƒ¹å–®']);
    // ğŸ‘‡ ç¢ºä¿ Excel è£¡é¢é€™æ®µæ–‡å­—é‚„åœ¨
    rows.push(['å–®ç­†è¨‚å–®30ç›’ä»¥ä¸Šï¼Œå»ºè­°180å…ƒ/äººèµ·è·³ï¼Œä»¥ä¸Šæœªç¨…æœªå«äº¤é€šè²»ã€‚']); 
    
    rows.push([null]);
    rows.push(['å®¢æˆ¶åç¨±', client]);
    rows.push(['å ±åƒ¹æ—¥æœŸ', date]);
    rows.push([null]);
    rows.push(['é …ç›®åç¨±ï¼ˆä¸»èœï¼‰èˆ‡å…§å®¹','å–®åƒ¹','æ•¸é‡','å°è¨ˆ']);

    const items = $$('#order-tbody tr').map(tr => ({
      group: tr.dataset.group,
      desc: tr.children[0].textContent,
      price: Number(tr.dataset.price||0),
      qty: Number(tr.dataset.qty||0),
      subtotal: Number(tr.dataset.price||0) * Number(tr.dataset.qty||0)
    }));

    const byGroup = {};
    items.forEach(it => { (byGroup[it.group] ||= []).push(it); });
    Object.keys(byGroup).forEach(g => {
      rows.push([`--- ${g} ---`, null, null, null]);
      byGroup[g].forEach(it => rows.push([it.desc, it.price, it.qty, it.subtotal]));
    });

    const total = items.reduce((a,b)=>a+b.subtotal,0);
    rows.push([null]);
    rows.push([null,null,'å°è¨ˆ', total]);
    rows.push([null,null,'ç¸½è¨ˆ', total]);
    

    const ws = XLSX.utils.aoa_to_sheet(rows);
    ws['!cols'] = [{wch:64},{wch:10},{wch:10},{wch:14}];
    ws['!merges'] = [ { s:{r:0,c:0}, e:{r:0,c:3} }, { s:{r:1,c:0}, e:{r:1,c:3} } ]; 

    const headerRows = 6;
    rows.forEach((r, i) => {
      if (i >= headerRows && i < rows.length - 3) {
        const cellA = `A${i+1}`;
        if (r[1] !== null) {
          if (ws[cellA]) ws[cellA].s = { alignment:{ wrapText:true, vertical:'top' } };
        } else {
          ws['!merges'].push({ s:{r:i,c:0}, e:{r:i,c:3} });
          if (ws[cellA]) ws[cellA].s = { font:{bold:true}, alignment:{ horizontal:'center' } };
        }
      }
    });

    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'å ±åƒ¹å–®');
    XLSX.writeFile(wb, filename);
  }
  window.generateExcel = generateExcel;

  (function initMeta(){
    const today = new Date();
    $('#date').value = new Date(today.getTime() - today.getTimezoneOffset()*60000).toISOString().slice(0,10);
  })();

  selPrice.addEventListener('input', (e) => {
    e.target.value = e.target.value.replace(/[^0-9]/g, '');
  });

  window.addEventListener('load', () => {
    console.log('ğŸ“‹ å ±åƒ¹å–®é é¢å·²æº–å‚™å°±ç·’ï¼è«‹å…ˆè¼¸å…¥å®¢æˆ¶è³‡è¨Šï¼Œå†é¸æ“‡é¤ç›’ç¨®é¡');
    $('#client').focus();
  });
</script>
</body>
</html>
